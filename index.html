
<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ouro L√≠quido: Uma Viagem pela Hist√≥ria Milenar do Azeite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f9fafb; /* bg-gray-50 */
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Custom styles for modals to be controlled by JS */
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            inset: 0;
            background-color: rgba(0,0,0,0.8);
            z-index: 50;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        .modal.active {
            display: flex; /* Shown when active */
        }
        .cursor-zoom-in {
            cursor: zoom-in;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Image Zoom Modal -->
    <div id="zoom-modal" class="modal" onclick="toggleZoomModal(null)">
        <div class="relative bg-black/80 rounded-lg shadow-2xl overflow-hidden w-full max-w-5xl h-full max-h-[90vh]" onclick="event.stopPropagation()">
            <button onclick="toggleZoomModal(null)" class="absolute top-2 right-2 bg-white/80 hover:bg-white text-gray-800 rounded-full w-10 h-10 flex items-center justify-center font-bold text-2xl shadow-lg z-10">√ó</button>
            <img id="zoomed-image" src="" alt="Imagem ampliada" class="w-full h-full object-contain"/>
        </div>
    </div>

    <script>
        // --- DATA CONSTANTS ---
        const storyPages = [
            { image: './image1.jpg', text: 'No cora√ß√£o quente do Alentejo, entre fileiras modernas e ordenadas de oliveiras, trabalhava Irina. Os seus bra√ßos √°geis apanhavam a azeitona preta e roxa, o "ouro l√≠quido" da sua terra.' },
            { image: './image2.jpg', text: 'Era a √©poca da colheita, o cl√≠max de um ciclo que ela conhecia desde pequena. "√â apenas √≥leo," pensava, enquanto apanhava uma pedra invulgar, lisa e escura, que parecia um n√≥ de madeira petrificado.' },
            { image: './image3.jpg', text: 'Ao tocar na pedra, um arrepio percorreu-lhe a espinha, e o ar ficou quente e denso. O cheiro a terra e azeitona intensificou-se, transformando-se num aroma a mar e a lendas antigas. O campo moderno desvaneceu-se. De repente, Irina estava a observar uma oliveira retorcida e gigantesca, com ra√≠zes que pareciam abra√ßar o pr√≥prio tempo. Esta n√£o era uma √°rvore qualquer; era a testemunha de mil√©nios.' },
            { image: './image4.jpg', text: 'A √°rvore falou (mas n√£o com palavras) da sua origem long√≠nqua na √Åsia Menor, h√° eras. Irina viu folhas fossilizadas no ch√£o, e depois, vislumbrou a Idade do Bronze: m√£os antigas esmagavam os frutos numa pedra r√∫stica. "Antes de existir humanidade, n√≥s exist√≠amos," sussurrou a mem√≥ria da oliveira. "E a primeira gota de azeite foi o in√≠cio de uma alian√ßa sagrada."' },
            { image: './image5.jpg', text: 'A vis√£o mudou. Ela estava agora na Gr√©cia, assistindo √† disputa entre a deusa Atena e o deus Poseid√£o. Poseid√£o ofereceu um cavalo forte, mas Atena plantou a primeira oliveira. Os cidad√£os aclamaram a d√°diva de Atena: √≥leo para iluminar, curar e alimentar. "Fui a d√°diva mais valiosa," vibrou a √°rvore, "um s√≠mbolo de paz e abund√¢ncia."' },
            { image: './image6.jpg', text: 'O tempo avan√ßou. Irina viu grandes barcos fen√≠cios com velas quadradas a sulcar o Mediterr√¢neo. Os navegadores transportavam √¢nforas cheias. O azeite n√£o era apenas alimento; era riqueza, moeda de troca. Ela viu Hir√£o de Tiro a aceitar o azeite de um mercador, em troca de madeira para um Templo. O azeite unia reinos.' },
            { image: './image7.jpg', text: 'No cen√°rio seguinte, Roma Antiga. Ela observou um thermae (banho romano), onde o azeite era usado para a higiene e cosm√©tica. Depois, a escurid√£o da noite era cortada pelo brilho suave de uma lamparina a √≥leo. "Eu sou o sangue vital do quotidiano," explicou a mem√≥ria. "O que ilumina, cura, perfuma e protege."' },
            { image: './image8.jpg', text: 'A vis√£o ficou mais intensa, tocada por um significado mais profundo. Ela viu o grande Dil√∫vio a acalmar, e uma pomba a regressar √† Arca de No√©, trazendo um tenro ramo de oliveira. Paz. Reconcilia√ß√£o. A ira divina tinha cessado. E, depois, o Jardim de Gets√©mani, o "Lagar de Azeite," onde o fruto era esmagado para libertar o precioso √≥leo.' },
            { image: './image9.jpg', text: 'O cen√°rio mudou para o seu pa√≠s. Portugal medieval. Ela viu azeite, orgulhosamente portugu√™s, a ser embarcado em naus das Descobertas. Multas no C√≥digo Visig√≥tico protegiam a oliveira. Era um produto de valor estrat√©gico, um commodities essencial do imp√©rio. O azeite, agora, ligava continentes.' },
            { image: './image10.jpg', text: 'Com um suspiro, o ar quente do Alentejo voltou. Irina estava de novo no olival moderno, a segurar o n√≥ de madeira petrificado. Ela olhou para o moderno lagar ao longe, um edif√≠cio de metal e tecnologia. Mas agora, n√£o via apenas m√°quinas. Via a ess√™ncia de todos aqueles mil√©nios. O lagar moderno √© a continua√ß√£o do lagar de Gets√©mani e da pedra primitiva.' },
            { image: './image11.jpg', text: 'Irina juntou-se √† sua fam√≠lia e colocou as suas azeitonas na moega. Enquanto as prensas hidr√°ulicas e as centrifugadoras libertavam o √≥leo verde-esmeralda, ela j√° n√£o via apenas um alimento. Via a D√°diva de Atena, a moeda dos Fen√≠cios, a luz dos Romanos, o s√≠mbolo de Paz e o legado de Portugal. Em cada gota de "ouro l√≠quido" do Alentejo, corria toda a Hist√≥ria.' }
        ];
        const modules = [
            { id: 'modulo1', title: 'M√≥dulo 1: O Ber√ßo Milenar da Oliveira', icon: 'üåç', color: 'from-amber-600 to-yellow-700', content: { intro: 'A hist√≥ria de um bom azeite come√ßa na sua fonte: a oliveira. Uma √°rvore que remonta √† Era Terci√°ria, anterior ao aparecimento do homem.', sections: [ { title: 'Origens Ancestrais', text: 'A oliveira, na sua forma primitiva, remonta √† Era Terci√°ria, com origem na √Åsia Menor, S√≠ria e Palestina. Folhas fossilizadas datadas do Paleol√≠tico foram encontrados por toda a bacia do Mediterr√¢neo. H√° mais de 6 mil anos, os povos da Mesopot√¢mia j√° utilizavam o azeite.' }, { title: 'Expans√£o pelo Mediterr√¢neo', text: 'Foram os fen√≠cios que, nas suas rotas comerciais, transportaram a cultura da oliveira, semeando-a nas costas de todo o Mediterr√¢neo. O azeite tornou-se t√£o valioso que funcionava como moeda de troca.' } ], activity: { type: 'timeline', question: 'Combine os marcos hist√≥ricos com os seus per√≠odos ou localiza√ß√µes:', options: [ { id: 1, text: 'Origem primitiva da oliveira', answer: 'B' }, { id: 2, text: 'Primeiros vest√≠gios de produ√ß√£o (S√≠ria/Palestina)', answer: 'C' }, { id: 3, text: 'Uso do azeite como protetor (Mesopot√¢mia)', answer: 'A' } ], choices: [ { id: 'A', text: 'H√° mais de 6 mil anos' }, { id: 'B', text: 'Era Terci√°ria' }, { id: 'C', text: 'Idade do Bronze' } ] } } },
            { id: 'modulo2', title: 'M√≥dulo 2: As Ra√≠zes Antigas - Luz, Sa√∫de e Com√©rcio', icon: 'üí°', color: 'from-orange-600 to-amber-700', content: { intro: 'Na antiguidade, o azeite era muito mais que alimento. Era a fonte de luz da civiliza√ß√£o, a base da sa√∫de e o pilar da economia.', sections: [ { title: 'Tr√™s Pilares Vitais', items: [ { emoji: 'üí°', title: 'LUZ', text: 'Principal combust√≠vel para l√¢mpadas de argila, iluminando casas, templos e ruas' }, { emoji: 'ü©∫', title: 'SA√öDE', text: 'Base da limpeza (com estr√≠gil) e medicina, usado para tratar feridas e proteger a pele' }, { emoji: 'üí∞', title: 'COM√âRCIO', text: '"Ouro l√≠quido" transportado em √¢nforas, base da riqueza mediterr√¢nea' } ] }, { title: 'M√∫ltiplos Usos', text: 'Para gregos e romanos: culin√°ria, medica√ß√£o, unguento, perfume, combust√≠vel, lubrificante de alfaias e impermeabilizante de tecidos.' } ], activity: { type: 'archaeology', question: 'O Arque√≥logo Inesperado', description: 'Estes dois objetos foram essenciais em Roma, mas n√£o funcionavam sem um "combust√≠vel" que tamb√©m comiam. Que combust√≠vel √© esse e para que servia cada objeto?', objects: [ { id: 'lucerna', name: 'L√¢mpada a √≥leo romana (Lucerna)', use: 'ilumina√ß√£o' }, { id: 'estrigil', name: 'Estr√≠gil (raspador de metal)', use: 'higiene' } ], answer: 'azeite' } } },
            { id: 'modulo3', title: 'M√≥dulo 3: O Presente dos Deuses', icon: 'üëë', color: 'from-purple-600 to-indigo-700', content: { intro: 'Para as civiliza√ß√µes antigas, uma √°rvore t√£o vital s√≥ poderia ter origem divina. Lendas e mitos refor√ßam o seu estatuto sagrado.', sections: [ { title: 'Mitologia Grega', text: 'Na disputa pela cidade de Atenas, Poseid√£o ofereceu um cavalo forte, mas Atena presenteou os cidad√£os com uma oliveira capaz de produzir √≥leo para iluminar, curar e alimentar. A oliveira foi considerada a d√°diva mais valiosa.' }, { title: 'Mitologia Romana', text: 'R√≥mulo e Remo, os m√≠ticos fundadores de Roma, teriam visto a luz do dia pela primeira vez debaixo dos galhos da oliveira, associando a √°rvore √† g√©nese do imp√©rio.' }, { title: 'Cosmologia Eg√≠pcia', text: 'A d√°diva da olivicultura √© atribu√≠da √† deusa √çsis, que a ofereceu √† humanidade como s√≠mbolo de paz e abund√¢ncia.' } ], activity: { type: 'quote', question: 'Complete a cita√ß√£o de Virg√≠lio na Eneida:', text: 'E com um ramo de __________ o homem se purifica totalmente.', answer: 'oliveira' } } },
            { id: 'modulo4', title: 'M√≥dulo 4: S√≠mbolo Sagrado nas Religi√µes', icon: '‚ù§Ô∏è', color: 'from-blue-600 to-cyan-700', content: { intro: 'O azeite assume profundo significado espiritual, tornando-se s√≠mbolo sagrado nas grandes religi√µes monote√≠stas.', sections: [ { title: 'Juda√≠smo - A Presen√ßa Divina', text: 'O azeite simbolizava a presen√ßa de Deus entre os homens. Era usado em oferendas (enquanto o fermento simbolizava o pecado), na consagra√ß√£o de sacerdotes e para friccionar o corpo em ocasi√µes festivas. A sua aus√™ncia denunciava tristeza.' }, { title: 'Cristianismo - Un√ß√£o e Sacrif√≠cio', items: [ { emoji: 'üïäÔ∏è', text: 'O ramo de oliveira trazido pela pomba a No√©: s√≠mbolo universal de paz e reconcilia√ß√£o' }, { emoji: '‚õ™', text: 'Gets√©mani ("Lagar de Azeite"): onde Jesus foi "esmagado" pelo sacrif√≠cio, como azeitonas libertam √≥leo' }, { emoji: '‚ú®', text: 'Santos √ìleos: consagrados na Quinta-feira Santa para batismo, crisma e un√ß√£o dos enfermos' } ] }, { title: 'A Un√ß√£o Real', text: 'Messias (hebraico) e Cristo (grego) significam literalmente "O Ungido". A un√ß√£o com azeite consagrava reis e sacerdotes, mostrando que sua autoridade vinha de Deus.' } ], activity: { type: 'symbols', question: 'O Fio Condutor', description: 'H√° um elemento vegetal comum que une estas hist√≥rias. Qual √©, e o que representa em cada cen√°rio?', scenarios: [ { id: 1, text: 'Pomba regressa √† Arca de No√©', symbol: 'Paz' }, { id: 2, text: 'Atena planta uma √°rvore em Atenas', symbol: 'Sabedoria' }, { id: 3, text: 'Coroa√ß√£o de um rei medieval', symbol: 'Poder Divino' } ], answer: 'oliveira' } } },
            { id: 'modulo5', title: 'M√≥dulo 5: Da Cultura √† Mesa', icon: 'üìñ', color: 'from-green-600 to-emerald-700', content: { intro: 'O azeite tornou-se o pilar da Dieta Mediterr√¢nica, parte da "Tr√≠ade" com trigo e vinho, e evoluiu at√© √† perfei√ß√£o do Virgem Extra.', sections: [ { title: 'O Lagar Tradicional', text: 'M√≥s de pedra esmagavam as azeitonas, transformando-as em pasta. Esta era espalhada em capachos de fibra e prensada para extrair o l√≠quido. Por decanta√ß√£o, o azeite subia ao topo.' }, { title: 'Problemas do M√©todo Antigo', items: [ { emoji: 'üçÇ', text: 'Fermenta√ß√£o: Capachos dif√≠ceis de limpar causavam sabor ran√ßoso' }, { emoji: 'üå¨Ô∏è', text: 'Oxida√ß√£o: Exposi√ß√£o ao ar roubava aromas frutados e frescura' } ] }, { title: 'Azeite Virgem Extra', text: 'O auge da qualidade moderna. Deve ter acidez inferior a 0,8% e zero defeitos na prova sensorial. Tem de apresentar frutado (fresco), podendo ter amargo e picante - sinais de qualidade e antioxidantes.' }, { title: 'O Legado Portugu√™s', text: 'Portugal consolidou-se como refer√™ncia mundial. O Alentejo √© o cora√ß√£o da produ√ß√£o nacional, com azeites de qualidade premiada. Um dos primeiros produtos exportados na √âpoca dos Descobrimentos.' } ], activity: { type: 'problem', question: 'O Bom, o Mau e o Azeite', scenario: 'Estamos em 1500 d.C. num lagar tradicional. O nosso azeite sabe bem quando feito, mas passados dois meses tem sabor a "velho" e "h√∫mido". O que est√° a estragar o sabor?', options: [ { id: 'A', text: 'A temperatura da prensagem', correct: false }, { id: 'B', text: 'Fermenta√ß√£o nos capachos e oxida√ß√£o pelo ar', correct: true }, { id: 'C', text: 'O tipo de azeitonas usado', correct: false }, { id: 'D', text: 'A √°gua utilizada no processo', correct: false } ] } } },
            { id: 'modulo6', title: 'M√≥dulo 6: O Guardi√£o da Sa√∫de', icon: '‚öïÔ∏è', color: 'from-teal-600 to-cyan-700', content: { intro: 'Reconhecido como um superalimento, o azeite √© um pilar da Dieta Mediterr√¢nica, associado a uma vida longa e saud√°vel. Descubra a ci√™ncia por tr√°s dos seus benef√≠cios.', sections: [{ title: 'O Cora√ß√£o da Dieta Mediterr√¢nica', items: [{ emoji: '‚ù§Ô∏è', title: 'Gordura "Boa"', text: 'Rico em √°cido oleico, uma gordura monoinsaturada que ajuda a reduzir o colesterol "mau" (LDL) e a aumentar o "bom" (HDL), protegendo a sa√∫de cardiovascular.' }, { emoji: 'üß†', title: 'Sa√∫de Cerebral', text: 'Estudos sugerem que o consumo regular de azeite virgem extra pode proteger contra o decl√≠nio cognitivo e doen√ßas como o Alzheimer, gra√ßas aos seus compostos anti-inflamat√≥rios.' }, { emoji: 'üí™', title: 'Poder Anti-inflamat√≥rio', text: 'Cont√©m Oleocanthal, um polifenol com um efeito anti-inflamat√≥rio semelhante ao do ibuprofeno, ajudando a combater a inflama√ß√£o cr√≥nica no corpo.' }] }, { title: 'O Segredo est√° nos Polifen√≥is', text: 'Os polifen√≥is s√£o poderosos antioxidantes presentes no azeite virgem extra de alta qualidade. Eles s√£o respons√°veis pelos sabores amargo e picante e combatem os radicais livres, que causam o envelhecimento celular e diversas doen√ßas. Quanto mais amargo e picante, mais saud√°vel!' }], activity: { type: 'problem', question: 'O que significa o "picante"?', scenario: 'Um turista prova um azeite virgem extra de alta qualidade e queixa-se de que "pica na garganta". Com base no que aprendeu, o que este atributo sensorial realmente indica sobre o azeite?', options: [{ id: 'A', text: 'Que o azeite est√° estragado (ran√ßoso) e n√£o deve ser consumido.', correct: false }, { id: 'B', text: 'Que o azeite tem um n√≠vel de acidez muito elevado, sendo de baixa qualidade.', correct: false }, { id: 'C', text: 'Que o azeite √© rico em Oleocanthal, um polifenol com potentes propriedades anti-inflamat√≥rias.', correct: true }, { id: 'D', text: 'Que o azeite foi mal filtrado e cont√©m impurezas da azeitona.', correct: false }] } } },
            { id: 'modulo7', title: 'M√≥dulo 7: A Arte da Prova e Escolha', icon: 'üßê', color: 'from-rose-600 to-pink-700', content: { intro: 'Nem todo o azeite √© igual. Aprender a provar e a ler um r√≥tulo transforma a sua experi√™ncia, permitindo-lhe escolher o "ouro l√≠quido" perfeito para cada ocasi√£o.', sections: [{ title: 'Como Provar Azeite (An√°lise Sensorial)', items: [{ emoji: 'üëÉ', title: 'Olfato (Frutado)', text: 'Aque√ßa o copo com as m√£os. Cheire o azeite. Procura aromas que lembrem frutos e vegetais frescos, como relva cortada, tomate, ma√ß√£ ou am√™ndoa.' }, { emoji: 'üëÖ', title: 'Paladar (Amargo e Picante)', text: 'Beba um pequeno gole. O amargo sente-se nos lados da l√≠ngua e o picante na garganta. Estes s√£o atributos POSITIVOS, indicando um azeite fresco e rico em antioxidantes.' }, { emoji: 'üé®', title: 'A Cor N√£o Importa', text: 'A cor do azeite, de verde a dourado, depende da variedade da azeitona e da sua matura√ß√£o, mas n√£o √© um indicador de qualidade. Por isso, os provadores profissionais usam copos azuis.' }] }, { title: 'Decifrando o R√≥tulo', text: 'Procure sempre por "Azeite Virgem Extra". Verifique a data de colheita (quanto mais recente, melhor) e a origem. Azeites com indica√ß√£o de variedade (ex: Cobran√ßosa, Galega) ou Denomina√ß√£o de Origem Protegida (DOP) s√£o geralmente uma aposta segura.' }], activity: { type: 'problem', question: 'O Consumidor Informado', scenario: 'Na prateleira do supermercado, encontra duas garrafas de azeite. Uma diz "Azeite Virgem Extra - Colheita 2024/2025" e a outra diz apenas "Azeite - Cont√©m azeites refinados e azeites virgens". Qual √© a escolha de maior qualidade e porqu√™?', options: [{ id: 'A', text: 'O "Azeite", porque a mistura de √≥leos o torna mais vers√°til.', correct: false }, { id: 'B', text: 'O "Azeite Virgem Extra", porque √© o sumo puro da azeitona, com data de colheita recente, garantindo frescura e qualidade.', correct: true }, { id: 'C', text: 'Ambos s√£o iguais, a designa√ß√£o √© apenas marketing.', correct: false }, { id: 'D', text: 'Depende da cor. O mais verde √© sempre o melhor.', correct: false }] } } }
        ];
        const finalQuiz = [
            { id: 'q1', question: 'Em qual regi√£o a oliveira, na sua forma primitiva, tem origem na Era Terci√°ria?', type: 'mcq', options: [ { id: 'A', text: 'Regi√£o do C√°ucaso' }, { id: 'B', text: '√Åsia Menor, S√≠ria e Palestina' }, { id: 'C', text: 'Bacia do Mediterr√¢neo Ocidental' }, { id: 'D', text: 'Pen√≠nsula Ib√©rica' } ], correct: 'B', feedback: { correct: 'Exato! A oliveira tem as suas ra√≠zes mais antigas na √Åsia Menor, espalhando-se depois pelo Mediterr√¢neo.', incorrect: 'Quase! Embora a oliveira seja um s√≠mbolo do Mediterr√¢neo, a sua origem mais remota √© na √Åsia Menor, que inclui a S√≠ria e a Palestina.' } },
            { id: 'q2', question: 'A acidez do azeite era percebida sensorialmente pelos romanos como indicador de qualidade?', type: 'truefalse', options: [ { id: 'V', text: 'Verdadeiro' }, { id: 'F', text: 'Falso' } ], correct: 'F', feedback: { correct: 'Correto! A acidez √© um par√¢metro qu√≠mico medido em laborat√≥rio. O amargo e o picante, que se sentem no paladar, s√£o na verdade indicadores de qualidade e antioxidantes.', incorrect: 'Incorreto. A acidez (teor de √°cidos gordos livres) √© impercet√≠vel ao paladar e s√≥ pode ser medida quimicamente. N√£o confunda acidez com o sabor picante ou amargo, que s√£o atributos positivos.' } },
            { id: 'q3', question: 'Complete: No√© soltou uma pomba que retornou √† arca trazendo um ramo de ___, s√≠mbolo de ___.', type: 'fill', answer: 'oliveira', answer2: 'paz', feedback: { correct: 'Perfeito! A pomba retornou com um ramo de oliveira, que se tornou o s√≠mbolo universal de paz e um novo come√ßo.', incorrect: 'A resposta correta √© "oliveira" e "paz". Este √© um dos simbolismos mais fortes associados √† oliveira na tradi√ß√£o judaico-crist√£.' } },
            { id: 'q4', question: 'Qual destes N√ÉO era um uso conhecido do azeite por gregos e romanos?', type: 'mcq', options: [ { id: 'A', text: 'Combust√≠vel para ilumina√ß√£o' }, { id: 'B', text: 'Unguento ou b√°lsamo' }, { id: 'C', text: 'Lubrificante de alfaias' }, { id: 'D', text: 'Agente de limpeza dom√©stica para metais' } ], correct: 'D', feedback: { correct: 'Isso mesmo! O azeite tinha in√∫meros usos, mas a limpeza de metais n√£o era um deles. Servia para iluminar, cozinhar, curar e muito mais.', incorrect: 'Incorreto. Embora o azeite fosse incrivelmente vers√°til, n√£o era usado para limpar metais. Todas as outras op√ß√µes eram usos comuns na antiguidade.' } },
            { id: 'q5', question: 'Qual era o nome do instrumento romano usado com azeite para a higiene corporal ap√≥s os banhos?', type: 'mcq', options: [ { id: 'A', text: 'Lucerna' }, { id: 'B', text: 'Estr√≠gil' }, { id: 'C', text: '√Çnfora' }, { id: 'D', text: 'Thermae' } ], correct: 'B', feedback: { correct: 'Correto! O estr√≠gil era um raspador de metal que, combinado com azeite, era usado para remover sujidade e √≥leo do corpo, funcionando como o sab√£o da √©poca.', incorrect: 'Incorreto. O instrumento era o estr√≠gil. A lucerna era a l√¢mpada, a √¢nfora o recipiente de transporte e as thermae os pr√≥prios banhos p√∫blicos.' } },
            { id: 'q6', question: 'Na mitologia grega, quem ofereceu a oliveira como presente aos cidad√£os de Atenas?', type: 'mcq', options: [ { id: 'A', text: 'Zeus' }, { id: 'B', text: 'Poseid√£o' }, { id: 'C', text: 'Atena' }, { id: 'D', text: '√çsis' } ], correct: 'C', feedback: { correct: 'Exato! A deusa Atena ofereceu a oliveira, considerada mais √∫til do que o cavalo de Poseid√£o, e assim deu o nome √† cidade de Atenas.', incorrect: 'A resposta correta √© Atena. Na mitologia grega, a sua d√°diva da oliveira foi vista como um presente de paz, sabedoria e prosperidade, superando o cavalo de guerra de Poseid√£o.' } },
            { id: 'q7', question: 'Qual o significado literal das palavras "Messias" (hebraico) e "Cristo" (grego)?', type: 'mcq', options: [ { id: 'A', text: 'O Aben√ßoado' }, { id: 'B', text: 'O Ungido' }, { id: 'C', text: 'O Salvador' }, { id: 'D', text: 'O Consagrado' } ], correct: 'B', feedback: { correct: 'Correto! "Messias" e "Cristo" significam "O Ungido", refletindo a pr√°tica sagrada de ungir reis e sacerdotes com azeite como sinal da b√™n√ß√£o divina.', incorrect: 'A resposta correta √© "O Ungido". A un√ß√£o com azeite era um ritual de consagra√ß√£o fundamental, significando que a autoridade da pessoa vinha de Deus.' } },
            { id: 'q8', question: 'Qual o limite m√°ximo de acidez para um azeite ser classificado como Virgem Extra?', type: 'mcq', options: [ { id: 'A', text: '0,4%' }, { id: 'B', text: '0,8%' }, { id: 'C', text: '1,0%' }, { id: 'D', 'text': '2,0%' } ], correct: 'B', feedback: { correct: 'Isso mesmo! Para ser Virgem Extra, um azeite n√£o pode ultrapassar 0,8% de acidez e tem de ser sensorialmente perfeito.', incorrect: 'A resposta correta √© 0,8%. Este √© o limite m√°ximo de acidez para a categoria de maior qualidade, o Azeite Virgem Extra.' } },
            { id: 'q9', question: 'O azeite faz parte da "Tr√≠ade Mediterr√¢nica" juntamente com quais outros dois alimentos?', type: 'mcq', options: [ { id: 'A', text: 'P√£o e Queijo' }, { id: 'B', text: 'Trigo e Vinho' }, { id: 'C', text: 'Peixe e Legumes' }, { id: 'D', text: 'Carne e Frutas' } ], correct: 'B', feedback: { correct: 'Perfeito! O trigo para o p√£o, a vinha para o vinho e a oliveira para o azeite formavam a sagrada "Tr√≠ade Mediterr√¢nica", a base da vida e da cultura na regi√£o.', incorrect: 'A resposta correta √© Trigo e Vinho. Estes tr√™s elementos eram a base da agricultura, da economia e da dieta de muitas civiliza√ß√µes antigas do Mediterr√¢neo.' } },
            { id: 'q10', question: 'Em Portugal, que c√≥digo legal antigo j√° aplicava multas para proteger as oliveiras, demonstrando o seu valor estrat√©gico?', type: 'mcq', options: [ { id: 'A', text: 'As Ordena√ß√µes Afonsinas' }, { id: 'B', text: 'O C√≥digo de Hamurabi' }, { id: 'C', text: 'O C√≥digo Visig√≥tico' }, { id: 'D', text: 'A Lei das Doze T√°buas' } ], correct: 'C', feedback: { correct: 'Correto! O C√≥digo Visig√≥tico, que vigorou na Pen√≠nsula Ib√©rica durante a Idade M√©dia, j√° protegia as oliveiras com leis espec√≠ficas, mostrando a sua enorme import√¢ncia econ√≥mica.', incorrect: 'A resposta correta √© o C√≥digo Visig√≥tico. Muito antes de outras legisla√ß√µes, este c√≥digo j√° reconhecia a oliveira como um recurso vital que precisava de ser protegido por lei.' } }
        ];

        // --- APPLICATION STATE ---
        let appState = {
            page: 'intro', // 'intro', 'story', 'modules', 'module', 'quiz'
            currentModuleIndex: null,
            moduleProgress: {}, // { moduleId: score }
            storyPageIndex: 0,
            // ModuleDetail state
            activityAnswers: {},
            textAnswer: '',
            showFeedback: false,
            isCompleted: false,
            // Quiz state
            quizAnswers: {},
            showQuizFeedback: {},
            userName: '',
            showCertificate: false,
        };

        const root = document.getElementById('root');

        // --- NAVIGATION & RENDERING ---
        function navigateTo(newPage, data = null) {
            appState.page = newPage;
            if (newPage === 'module') {
                appState.currentModuleIndex = data;
                // Reset module detail state when navigating to a new module
                appState.activityAnswers = {};
                appState.textAnswer = '';
                appState.showFeedback = false;
                const module = modules[appState.currentModuleIndex];
                appState.isCompleted = (appState.moduleProgress[module.id] || 0) > 0;
            } else {
                appState.currentModuleIndex = null;
            }
            if(newPage === 'story') {
                appState.storyPageIndex = 0;
            }
             if(newPage === 'quiz') {
                appState.quizAnswers = {};
                appState.showQuizFeedback = {};
                appState.userName = '';
                appState.showCertificate = false;
            }
            window.scrollTo(0, 0);
            renderApp();
        }

        function renderApp() {
            let content = '';
            switch (appState.page) {
                case 'intro': content = renderIntro(); break;
                case 'story': content = renderStory(); break;
                case 'modules': content = renderModuleList(); break;
                case 'module': content = renderModuleDetail(); break;
                case 'quiz': content = renderQuiz(); break;
                default: content = renderIntro();
            }
            root.innerHTML = renderNavbar() + `<main class="pt-20 fade-in">${content}</main>`;
        }
        
        // --- COMPONENT RENDER FUNCTIONS ---
        function renderNavbar() {
            const navLink = (pageName, text, activePages = []) => {
                const isActive = appState.page === pageName || activePages.includes(appState.page);
                const activeClass = "text-amber-700 font-bold border-b-2 border-amber-600";
                const inactiveClass = "text-gray-600 hover:text-amber-700 transition-colors";
                return `
                    <li>
                        <button onclick="navigateTo('${pageName}')" class="px-3 py-2 text-lg font-medium ${isActive ? activeClass : inactiveClass}" aria-current="${isActive ? 'page' : 'false'}">
                            ${text}
                        </button>
                    </li>
                `;
            };
            return `
                <header class="fixed top-0 left-0 right-0 bg-white/90 backdrop-blur-md shadow-md z-50">
                    <nav class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div class="flex justify-between items-center h-20">
                            <div class="flex items-center space-x-3 cursor-pointer" onclick="navigateTo('intro')">
                                <span class="text-4xl" aria-hidden="true">ü´í</span>
                                <span class="font-bold text-2xl text-amber-800">Ouro L√≠quido</span>
                            </div>
                            <ul class="hidden md:flex items-center space-x-6">
                                ${navLink('intro', 'In√≠cio')}
                                ${navLink('story', 'Hist√≥ria')}
                                ${navLink('modules', 'M√≥dulos', ['module'])}
                                ${navLink('quiz', 'Question√°rio')}
                            </ul>
                        </div>
                    </nav>
                </header>
            `;
        }

        function renderFooter() {
            return `
                <footer class="bg-gradient-to-r from-amber-900 to-yellow-900 text-white py-6 mt-12">
                    <div class="max-w-6xl mx-auto px-4 text-center">
                        <p class="text-lg font-medium">Teod√≥sio Faria ¬©2025 Viagem pela Hist√≥ria do Azeite</p>
                        <p class="text-amber-200 text-sm mt-2">Uma jornada atrav√©s dos mil√©nios do ouro l√≠quido</p>
                    </div>
                </footer>
            `;
        }
        
        function renderImageWithPlaceholder(src, alt) {
            return `<div class="w-full h-full cursor-zoom-in" onclick="toggleZoomModal('${src}')"><img src="${src}" alt="${alt}" class="w-full h-full object-cover" onerror="this.parentElement.innerHTML = '<div class=\\'bg-gray-200 text-gray-500 text-center p-8 flex flex-col items-center justify-center h-full\\'><p class=\\'text-3xl mb-2\\'>üì∑</p><p class=\\'text-lg mb-2\\'>Imagem n√£o dispon√≠vel</p></div>'"/></div>`;
        }

        function renderIntro() {
            return `
                <div class="min-h-screen bg-gradient-to-br from-amber-50 via-yellow-50 to-orange-50 p-8 flex items-center justify-center">
                    <div class="max-w-4xl mx-auto text-center">
                        <h1 class="text-5xl md:text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-amber-600 to-yellow-700 mb-4">Ouro L√≠quido</h1>
                        <p class="text-2xl md:text-3xl text-gray-700 mb-2">Uma Viagem pela Hist√≥ria Milenar do Azeite</p>
                        <p class="text-lg md:text-xl text-gray-600 mb-12">Mais do que um Alimento, um S√≠mbolo</p>
                        <div class="bg-white rounded-2xl shadow-2xl p-8 mb-8 text-left">
                            <p class="text-lg text-gray-700 leading-relaxed mb-6">O azeite √© um pilar incontorn√°vel da gastronomia mediterr√¢nea, mas a sua influ√™ncia transcende a cozinha, enraizando-se profundamente na heran√ßa cultural da humanidade. Desde a antiguidade, as suas gotas douradas t√™m temperado n√£o s√≥ pratos, mas tamb√©m rituais, mitos e a pr√≥pria hist√≥ria.</p>
                            <p class="text-lg text-gray-700 leading-relaxed">Este documento convida-o a uma viagem no tempo, explorando as origens ancestrais da oliveira, o seu papel central nas grandes civiliza√ß√µes da Antiguidade e o seu profundo simbolismo sagrado nas principais religi√µes do mundo.</p>
                        </div>
                        <div class="space-y-6">
                            <button onclick="navigateTo('story')" class="w-full max-w-xs px-8 py-4 bg-gradient-to-r from-amber-600 to-yellow-700 text-white text-xl font-bold rounded-xl shadow-lg hover:shadow-xl transform hover:scale-105 transition">Come√ßar a Viagem</button>
                            <div class="flex justify-center gap-4 flex-wrap">
                                <button onclick="toggleModal('video-modal')" class="px-6 py-3 bg-white border-2 border-amber-500 text-amber-700 text-lg font-semibold rounded-xl shadow-md hover:shadow-lg transform hover:scale-105 transition">üé• Ver V√≠deo</button>
                                <button onclick="toggleModal('audio-modal')" class="px-6 py-3 bg-white border-2 border-amber-500 text-amber-700 text-lg font-semibold rounded-xl shadow-md hover:shadow-lg transform hover:scale-105 transition">üéß Ouvir Podcast</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Modals -->
                <div id="video-modal" class="modal" onclick="toggleModal('video-modal')">
                    <div class="relative bg-black rounded-lg shadow-2xl overflow-hidden w-full max-w-4xl" onclick="event.stopPropagation()">
                        <button onclick="toggleModal('video-modal')" class="absolute top-2 right-2 bg-white/80 hover:bg-white text-gray-800 rounded-full w-8 h-8 flex items-center justify-center font-bold text-xl shadow-lg z-10">√ó</button>
                        <video class="w-full" style="max-height: 90vh" controls><source src="./A_Hist√≥ria_do_Azeite.mp4" type="video/mp4" />O seu navegador n√£o suporta a tag de v√≠deo.</video>
                    </div>
                </div>
                <div id="audio-modal" class="modal" onclick="toggleModal('audio-modal')">
                    <div class="relative bg-white rounded-lg shadow-2xl p-8 w-full max-w-md text-center" onclick="event.stopPropagation()">
                        <button onclick="toggleModal('audio-modal')" class="absolute top-2 right-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-full w-8 h-8 flex items-center justify-center font-bold text-xl z-10">√ó</button>
                        <div class="mb-4"><span class="text-5xl">üéß</span><h3 class="text-2xl font-bold text-amber-800 mt-2">Podcast: O Fio Dourado</h3></div>
                        <audio class="w-full" controls><source src="./Azeite_O_Fio_Dourado.mp3" type="audio/mpeg" />O seu navegador n√£o suporta a tag de √°udio.</audio>
                    </div>
                </div>
                ${renderFooter()}
            `;
        }

        function renderStory() {
            const page = storyPages[appState.storyPageIndex];
            const isLastPage = appState.storyPageIndex === storyPages.length - 1;
            const isCoverPage = appState.storyPageIndex === 0;

            if (isCoverPage) {
                return `
                    <div class="min-h-screen bg-gradient-to-br from-amber-600 via-yellow-600 to-orange-700 p-4 sm:p-8 flex items-center justify-center">
                        <div class="max-w-5xl w-full mx-auto">
                            <div class="bg-white/10 backdrop-blur-sm rounded-3xl shadow-2xl overflow-hidden border-4 border-white/30 p-8 sm:p-12">
                                <div class="text-center mb-8"><div class="text-8xl mb-6">ü´í</div><h1 class="text-5xl sm:text-6xl font-bold text-white mb-4 drop-shadow-lg">O Ouro L√≠quido da Oliveira</h1><div class="h-1 w-32 bg-white/50 mx-auto mb-6"></div><p class="text-2xl text-white/90 italic mb-8">Uma viagem no tempo atrav√©s dos olhos de Irina</p></div>
                                <div class="bg-white/20 backdrop-blur-md rounded-2xl p-6 mb-8"><p class="text-lg text-white leading-relaxed text-center">${page.text}</p></div>
                                <div class="flex justify-center"><button onclick="handleStoryNav('next')" class="px-8 py-4 bg-white text-amber-700 text-xl font-bold rounded-xl shadow-lg hover:shadow-xl transform hover:scale-105 transition flex items-center gap-3">Come√ßar a Viagem ‚Üí</button></div>
                            </div>
                        </div>
                    </div>
                    ${renderFooter()}
                `;
            }

            return `
                <div class="min-h-screen bg-gradient-to-br from-amber-50 to-yellow-50 p-4 sm:p-8">
                    <div class="max-w-6xl w-full mx-auto">
                        <div class="bg-white rounded-2xl shadow-2xl overflow-hidden">
                            <div class="bg-gradient-to-r from-amber-600 to-yellow-700 p-4 sm:p-6 text-white">
                                <h2 class="text-2xl sm:text-3xl font-bold">O Ouro L√≠quido da Oliveira</h2>
                                <p class="text-amber-100 mt-1 text-sm sm:text-base">Uma viagem no tempo atrav√©s dos olhos de Irina</p>
                            </div>
                            <div class="p-4 sm:p-8">
                                <div class="grid md:grid-cols-2 gap-6 mb-8">
                                    <div class="bg-gray-200 rounded-xl overflow-hidden h-64 md:h-96 flex items-center justify-center shadow-lg">
                                        ${renderImageWithPlaceholder(page.image, `P√°gina ${appState.storyPageIndex + 1}`)}
                                    </div>
                                    <div class="flex items-center">
                                        <div class="bg-gradient-to-br from-amber-50 to-yellow-50 p-6 rounded-xl border-2 border-amber-200 shadow-md">
                                            <div class="text-amber-600 font-bold text-sm mb-3">Cap√≠tulo ${appState.storyPageIndex}</div>
                                            <p class="text-base sm:text-lg leading-relaxed text-gray-800">${page.text}</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center flex-wrap gap-4 pt-4 border-t-2 border-gray-200">
                                    <button onclick="handleStoryNav('prev')" ${appState.storyPageIndex <= 1 ? 'disabled' : ''} class="flex items-center gap-2 px-6 py-3 bg-amber-600 text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-amber-700 transition shadow-md">‚Üê Anterior</button>
                                    <span class="text-gray-600 font-medium">P√°gina ${appState.storyPageIndex + 1} de ${storyPages.length}</span>
                                    ${!isLastPage ? 
                                        `<button onclick="handleStoryNav('next')" class="flex items-center gap-2 px-6 py-3 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition shadow-md">Pr√≥xima ‚Üí</button>` :
                                        `<button onclick="navigateTo('modules')" class="flex items-center gap-2 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition shadow-md">Come√ßar M√≥dulos ‚Üí</button>`
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                ${renderFooter()}
            `;
        }
        
        function renderModuleList() {
            const totalModuleScore = Object.values(appState.moduleProgress).reduce((sum, score) => sum + (Number(score) || 0), 0);
            const maxModuleScore = modules.length * 100;
            const modulePercentage = maxModuleScore > 0 ? Math.round((totalModuleScore / maxModuleScore) * 100) : 0;
            const completedModules = Object.values(appState.moduleProgress).filter(score => Number(score) > 0).length;

            return `
                <div class="min-h-screen bg-gradient-to-br from-slate-50 to-gray-100 p-4 sm:p-8">
                    <div class="max-w-6xl mx-auto">
                        <div class="text-center mb-12">
                            <h2 class="text-4xl font-bold text-gray-800 mb-4">M√≥dulos de Aprendizagem</h2>
                            <p class="text-xl text-gray-600">Escolha um m√≥dulo para come√ßar a explorar</p>
                            ${completedModules > 0 ? `
                                <div class="mt-6 inline-block bg-white rounded-xl shadow-lg p-6">
                                    <p class="text-lg font-semibold text-gray-700 mb-2">Progresso dos M√≥dulos</p>
                                    <div class="flex items-center gap-4">
                                        <div class="text-3xl font-bold text-amber-600">${totalModuleScore}/${maxModuleScore}</div>
                                        <div class="flex-1 bg-gray-200 rounded-full h-4 min-w-[200px]">
                                            <div class="bg-gradient-to-r from-amber-500 to-yellow-600 h-4 rounded-full transition-all duration-500" style="width: ${modulePercentage}%"></div>
                                        </div>
                                        <span class="text-xl font-bold text-gray-700">${modulePercentage}%</span>
                                    </div>
                                </div>` : ''
                            }
                        </div>
                        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                            ${modules.map((module, idx) => {
                                const score = appState.moduleProgress[module.id] || 0;
                                const isCompleted = score > 0;
                                return `
                                    <div onclick="navigateTo('module', ${idx})" class="bg-white rounded-xl shadow-lg hover:shadow-2xl transform hover:-translate-y-1 transition-all duration-300 cursor-pointer overflow-hidden flex flex-col">
                                        <div class="bg-gradient-to-r ${module.color} p-6 text-white">
                                            <div class="flex items-center justify-between mb-2">
                                                <div class="flex items-center gap-3"><span class="text-3xl" title="${module.title}">${module.icon}</span><span class="text-2xl font-bold">M√≥dulo ${idx + 1}</span></div>
                                                ${isCompleted ? '<span class="text-3xl font-bold text-white">‚úì</span>' : ''}
                                            </div>
                                            ${isCompleted ? `<div class="text-sm font-semibold bg-white/20 rounded px-2 py-1 inline-block">Pontua√ß√£o: ${score}/100</div>` : ''}
                                        </div>
                                        <div class="p-6 flex-grow">
                                            <h3 class="text-xl font-bold text-gray-800 mb-3">${module.title.split(': ')[1]}</h3>
                                            <p class="text-gray-600">${module.content.intro}</p>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        <div class="text-center">
                            <button onclick="navigateTo('quiz')" class="px-8 py-4 bg-gradient-to-r from-green-600 to-emerald-700 text-white text-xl font-bold rounded-xl shadow-lg hover:shadow-xl transform hover:scale-105 transition inline-flex items-center gap-3">üèÜ Question√°rio Final</button>
                        </div>
                    </div>
                </div>
                ${renderFooter()}
            `;
        }

        function renderModuleDetail() {
            const module = modules[appState.currentModuleIndex];
            if (!module) return '<div>M√≥dulo n√£o encontrado.</div>';
            
            const activity = module.content.activity;
            const currentScore = appState.moduleProgress[module.id] || 0;
            const showFeedback = appState.showFeedback || currentScore > 0;
            const isCompleted = appState.isCompleted || currentScore > 0;
            
            const checkFinalAnswer = () => {
                if (!isCompleted && !showFeedback) return false;
                switch (activity.type) {
                    case 'timeline':
                        return activity.options.every(opt => appState.activityAnswers[opt.id] === opt.answer);
                    case 'archaeology':
                    case 'quote':
                    case 'symbols':
                        return appState.textAnswer.toLowerCase().trim().includes(activity.answer.toLowerCase());
                    case 'problem':
                        const selectedOption = activity.options.find(opt => opt.id === appState.textAnswer);
                        return selectedOption?.correct === true;
                    default: return false;
                }
            };
            const isCorrect = checkFinalAnswer();

            const renderActivity = () => {
                switch (activity.type) {
                    case 'timeline':
                        return `
                            <p class="text-gray-700 mb-6 font-medium">${activity.question}</p>
                            ${activity.options.map(option => `
                                <div class="bg-white p-4 rounded-lg shadow mb-4">
                                    <p class="font-medium mb-3">${option.id}. ${option.text}</p>
                                    <select class="w-full p-3 border-2 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors ${
                                        showFeedback && appState.activityAnswers[option.id] === option.answer ? 'border-green-500 bg-green-50' :
                                        showFeedback && appState.activityAnswers[option.id] !== option.answer ? 'border-red-500 bg-red-50' :
                                        'border-gray-300'
                                    }" ${showFeedback ? 'disabled' : ''} onchange="handleTimelineAnswer(${option.id}, this.value)">
                                        <option value="">Selecione...</option>
                                        ${activity.choices.map(choice => `<option value="${choice.id}" ${appState.activityAnswers[option.id] === choice.id ? 'selected' : ''}>${choice.id}. ${choice.text}</option>`).join('')}
                                    </select>
                                </div>
                            `).join('')}
                        `;
                    case 'problem':
                        return `
                            <p class="text-xl font-semibold mb-3">${activity.question} üïµÔ∏è‚Äç‚ôÇÔ∏è</p>
                            <div class="bg-amber-50 p-4 rounded-lg mb-6 border-l-4 border-amber-500"><p class="text-gray-700 italic">${activity.scenario}</p></div>
                            <div class="space-y-3">
                                ${activity.options.map(option => `
                                    <button onclick="handleProblemAnswer('${option.id}')" ${showFeedback ? 'disabled' : ''} class="w-full text-left p-4 bg-white rounded-lg border-2 transition disabled:opacity-70 ${
                                        showFeedback && option.correct ? 'border-green-500 bg-green-50' :
                                        showFeedback && !option.correct && appState.textAnswer === option.id ? 'border-red-500 bg-red-50' :
                                        'border-gray-300 hover:border-blue-500 hover:bg-blue-50'
                                    }">
                                        <span class="font-bold">${option.id}.</span> ${option.text}
                                    </button>
                                `).join('')}
                            </div>
                        `;
                    default: // archaeology, quote, symbols
                        let specificContent = '';
                        if(activity.type === 'archaeology') {
                            specificContent = `
                                <p class="text-xl font-semibold mb-3">${activity.question} üè∫</p>
                                <p class="text-gray-700 mb-6">${activity.description}</p>
                                <div class="space-y-3 mb-6">${activity.objects.map(obj => `<div class="bg-white p-4 rounded-lg shadow"><p class="font-medium">üìú ${obj.name}</p></div>`).join('')}</div>
                            `;
                        } else if (activity.type === 'quote') {
                             specificContent = `
                                <p class="text-gray-700 mb-4 font-medium">${activity.question}</p>
                                <p class="text-lg italic bg-white p-4 rounded-lg mb-4 border-l-4 border-purple-500">"${activity.text}"</p>
                             `;
                        } else if (activity.type === 'symbols') {
                            specificContent = `
                                <p class="text-xl font-semibold mb-3">${activity.question} üïäÔ∏èüëë</p>
                                <p class="text-gray-700 mb-6">${activity.description}</p>
                                <div class="space-y-3 mb-6">${activity.scenarios.map(s => `<div class="bg-white p-4 rounded-lg shadow"><p class="font-medium">‚Ä¢ ${s.text}</p></div>`).join('')}</div>
                            `;
                        }
                        return `
                            ${specificContent}
                            <input type="text" placeholder="Sua resposta..." class="w-full p-3 border-2 rounded-lg transition-colors ${
                                showFeedback && isCorrect ? 'border-green-500 bg-green-50' :
                                showFeedback && !isCorrect ? 'border-red-500 bg-red-50' :
                                'border-gray-300'
                            }" ${showFeedback ? 'disabled' : ''} value="${appState.textAnswer}" onchange="appState.textAnswer = this.value">
                            ${!showFeedback ? '<button onclick="handleTextAnswer()" class="mt-4 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Submeter</button>' : ''}
                        `;
                }
            };
            
            const renderFeedback = () => {
                if (!showFeedback) return '';
        
                const isCorrect = checkFinalAnswer();
                const feedbackClass = isCorrect ? 'bg-green-100 border-green-500 text-green-800' : 'bg-red-100 border-red-500 text-red-800';
                const feedbackIcon = isCorrect ? '‚úÖ' : '‚ùå';
                const feedbackTitle = isCorrect ? 'Muito bem! Resposta correta!' : 'Resposta incorreta.';
                const scoreText = isCorrect ? '(+100 pontos)' : '(+0 pontos)';
                
                let details = '';
                if (!isCorrect) {
                    switch(activity.type) {
                        case 'timeline':
                            details = `<p class="mt-2 text-sm">Reveja as suas respostas. As corretas est√£o destacadas em verde e as incorretas em vermelho.</p>`;
                            break;
                        case 'problem':
                            const correctAnswerText = activity.options.find(opt => opt.correct)?.text;
                            details = `<p class="mt-2 text-sm">A resposta correta era: <strong>${correctAnswerText}</strong></p>`;
                            break;
                        case 'archaeology':
                        case 'quote':
                        case 'symbols':
                             details = `<p class="mt-2 text-sm">A resposta correta era: <strong>${activity.answer}</strong></p>`;
                            break;
                    }
                }

                return `
                    <div class="mt-6 p-4 rounded-lg border-l-4 ${feedbackClass}">
                        <div class="flex items-center">
                            <div class="text-2xl mr-3">${feedbackIcon}</div>
                            <div>
                                <p class="font-bold">${feedbackTitle} <span class="font-normal">${scoreText}</span></p>
                                ${details}
                            </div>
                        </div>
                    </div>
                `;
            };

            return `
                <div class="min-h-screen bg-gradient-to-br from-slate-50 to-gray-100 p-4 sm:p-8">
                    <div class="max-w-4xl mx-auto">
                        <button onclick="navigateTo('modules')" class="mb-6 px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg flex items-center gap-2 transition">‚Üê Voltar aos M√≥dulos</button>
                        <div class="bg-white rounded-2xl shadow-2xl overflow-hidden">
                            <div class="bg-gradient-to-r ${module.color} p-6 text-white">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-4">
                                        <span class="text-4xl">${module.icon}</span>
                                        <div><h2 class="text-3xl font-bold">${module.title}</h2><p class="text-white/90 mt-1">${module.content.intro}</p></div>
                                    </div>
                                    ${currentScore > 0 ? `<div class="text-right bg-white/20 rounded-lg px-4 py-2"><p class="text-sm">Pontua√ß√£o</p><p class="text-2xl font-bold">${currentScore}/100</p></div>` : ''}
                                </div>
                            </div>
                            <div class="p-6 sm:p-8">
                                ${module.content.sections.map(section => `
                                    <div class="mb-8">
                                        <h3 class="text-2xl font-bold text-gray-800 mb-4">${section.title}</h3>
                                        ${section.text ? `<p class="text-gray-700 leading-relaxed mb-4">${section.text}</p>` : ''}
                                        ${section.items ? `<div class="space-y-3">${section.items.map(item => `
                                            <div class="flex items-start gap-3 bg-gray-50 p-4 rounded-lg">
                                                ${item.emoji ? `<span class="text-2xl mt-1">${item.emoji}</span>` : ''}
                                                <div class="flex-1">
                                                    ${item.title ? `<span class="font-bold text-gray-800">${item.title}: </span>` : ''}
                                                    <span class="text-gray-700">${item.text}</span>
                                                </div>
                                            </div>`).join('')}</div>` : ''}
                                    </div>`).join('')}
                                <div class="mt-12 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 sm:p-8 border-2 border-blue-200">
                                    <h3 class="text-2xl font-bold text-blue-900 mb-4">üéØ Atividade Interativa</h3>
                                    ${renderActivity()}
                                    ${renderFeedback()}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                ${renderFooter()}
            `;
        }

        function renderQuiz() {
            if (appState.showCertificate) {
                const totalModuleScore = Object.values(appState.moduleProgress).reduce((sum, score) => sum + (Number(score) || 0), 0);
                const maxModuleScore = modules.length * 100;
                const correctAnswersCount = finalQuiz.filter(q => checkQuizAnswer(q)).length;
                const quizScore = correctAnswersCount * 10;
                const maxQuizScore = finalQuiz.length * 10;
                const finalPercentage = Math.round(((totalModuleScore + quizScore) / (maxModuleScore + maxQuizScore)) * 100);

                return `
                    <div class="min-h-screen bg-gray-100 p-8 flex items-center justify-center">
                        <div class="max-w-4xl w-full text-center fade-in">
                            <div class="bg-white rounded-2xl shadow-2xl p-8 sm:p-12 border-4 border-amber-500 bg-[url('https://www.transparenttextures.com/patterns/arabesque.png')]">
                                <h2 class="text-4xl font-bold text-amber-800 mb-2">Certificado de Conclus√£o</h2>
                                <p class="text-gray-600 mb-8">Viagem pela Hist√≥ria do Azeite</p>
                                <p class="text-lg text-gray-700 mb-4">Este certificado √© concedido a</p>
                                <p class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-amber-700 to-yellow-800 mb-8 pb-2 border-b-2 border-amber-300 inline-block">${appState.userName}</p>
                                <p class="text-lg text-gray-700 mb-6">pela conclus√£o bem-sucedida do curso com uma pontua√ß√£o final de:</p>
                                <div class="text-7xl font-bold text-amber-600 mb-10">${finalPercentage}%</div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-left mb-8">
                                    <div class="bg-amber-50 p-4 rounded-lg"><p class="font-bold text-gray-700">Pontua√ß√£o dos M√≥dulos:</p><p class="text-xl text-amber-700">${totalModuleScore} / ${maxModuleScore}</p></div>
                                    <div class="bg-amber-50 p-4 rounded-lg"><p class="font-bold text-gray-700">Pontua√ß√£o do Question√°rio:</p><p class="text-xl text-amber-700">${quizScore} / ${maxQuizScore}</p></div>
                                </div>
                                <p class="text-gray-500 text-sm">Emitido em: ${new Date().toLocaleDateString('pt-PT')}</p>
                            </div>
                            <button onclick="window.location.reload()" class="mt-8 px-8 py-4 bg-gray-600 text-white rounded-xl hover:bg-gray-700 transition">Recome√ßar</button>
                        </div>
                    </div>
                    ${renderFooter()}
                `;
            }

            const allQuestionsAnswered = Object.keys(appState.showQuizFeedback).length === finalQuiz.length;

            return `
                <div class="min-h-screen bg-gradient-to-br from-slate-50 to-gray-100 p-4 sm:p-8">
                    <div class="max-w-4xl mx-auto">
                        <button onclick="navigateTo('modules')" class="mb-6 px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg flex items-center gap-2 transition">‚Üê Voltar aos M√≥dulos</button>
                        <div class="bg-white rounded-2xl shadow-2xl p-6 sm:p-8">
                            <h2 class="text-4xl font-bold text-gray-800 mb-4 text-center">üèÜ Question√°rio Final</h2>
                            <p class="text-xl text-gray-600 mb-10 text-center">Teste os seus conhecimentos sobre a hist√≥ria do azeite.</p>
                            <div class="space-y-8">
                                ${finalQuiz.map((q, idx) => `
                                    <div class="bg-gray-50 p-6 rounded-xl border-l-4 border-amber-500">
                                        <p class="text-lg font-semibold text-gray-800 mb-4">${idx + 1}. ${q.question}</p>
                                        ${q.type === 'mcq' ? `
                                            <div class="space-y-2">${q.options.map(opt => `
                                                <button onclick="handleQuizAnswer('${q.id}', '${opt.id}')" ${appState.showQuizFeedback[q.id] ? 'disabled' : ''} class="w-full text-left p-3 rounded-lg border-2 transition disabled:opacity-80 ${
                                                    appState.showQuizFeedback[q.id] && opt.id === q.correct ? 'border-green-500 bg-green-100' :
                                                    appState.showQuizFeedback[q.id] && opt.id !== q.correct && appState.quizAnswers[q.id] === opt.id ? 'border-red-500 bg-red-100' :
                                                    'border-gray-300 hover:border-blue-500 hover:bg-blue-50'
                                                }"><span class="font-bold">${opt.id}.</span> ${opt.text}</button>
                                            `).join('')}</div>
                                        ` : ''}
                                        ${q.type === 'truefalse' ? `
                                            <div class="flex gap-4">${q.options.map(opt => `
                                                <button onclick="handleQuizAnswer('${q.id}', '${opt.id}')" ${appState.showQuizFeedback[q.id] ? 'disabled' : ''} class="flex-1 p-3 rounded-lg border-2 font-bold transition disabled:opacity-80 ${
                                                    appState.showQuizFeedback[q.id] && opt.id === q.correct ? 'border-green-500 bg-green-100' :
                                                    appState.showQuizFeedback[q.id] && opt.id !== q.correct && appState.quizAnswers[q.id] === opt.id ? 'border-red-500 bg-red-100' :
                                                    'border-gray-300 hover:border-blue-500 hover:bg-blue-50'
                                                }">${opt.text}</button>
                                            `).join('')}</div>
                                        ` : ''}
                                        ${q.type === 'fill' ? `
                                            <input type="text" placeholder="Sua resposta..." class="w-full p-3 border-2 border-gray-300 rounded-lg" ${appState.showQuizFeedback[q.id] ? 'disabled' : ''} onblur="handleQuizAnswer('${q.id}', this.value)" />
                                        ` : ''}
                                        ${appState.showQuizFeedback[q.id] ? `
                                            <div class="mt-4 p-3 rounded-lg ${checkQuizAnswer(q) ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                                <p><span class="font-bold">${checkQuizAnswer(q) ? '‚úì' : '‚úó'}</span> ${typeof q.feedback === 'string' ? q.feedback : (checkQuizAnswer(q) ? q.feedback.correct : q.feedback.incorrect)}</p>
                                            </div>
                                        ` : ''}
                                    </div>
                                `).join('')}
                            </div>
                            ${allQuestionsAnswered ? `
                                <div class="mt-12 text-center bg-gradient-to-r from-amber-50 to-yellow-100 p-8 rounded-2xl border-2 border-amber-300">
                                    <h3 class="text-2xl font-bold text-gray-800 mb-2">Parab√©ns, concluiu o question√°rio!</h3>
                                    <p class="text-gray-700 mb-6">Insira o seu nome para gerar o seu certificado de conclus√£o.</p>
                                    <input type="text" value="${appState.userName}" onchange="appState.userName = this.value" placeholder="O seu nome completo" class="w-full max-w-md mx-auto p-4 border-2 border-amber-400 rounded-lg text-center text-lg focus:ring-2 focus:ring-amber-500" />
                                    <button onclick="handleGenerateCertificate()" class="mt-6 px-8 py-4 bg-gradient-to-r from-amber-600 to-yellow-700 text-white text-xl font-bold rounded-xl shadow-lg hover:shadow-xl transform hover:scale-105 transition">Gerar Certificado</button>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
                ${renderFooter()}
            `;
        }

        // --- EVENT HANDLERS & LOGIC ---
        function toggleModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.toggle('active');
                const mediaElement = modal.querySelector('video, audio');
                if (mediaElement && !modal.classList.contains('active')) {
                    mediaElement.pause();
                    mediaElement.currentTime = 0;
                }
            }
        }
        
        function toggleZoomModal(src) {
            const modal = document.getElementById('zoom-modal');
            const img = document.getElementById('zoomed-image');
            if (src && modal && img) {
                img.src = src;
                modal.classList.add('active');
            } else if (modal) {
                modal.classList.remove('active');
                img.src = ''; // Clear src to avoid showing old image briefly
            }
        }
        
        function handleStoryNav(direction) {
            if (direction === 'next' && appState.storyPageIndex < storyPages.length - 1) {
                appState.storyPageIndex++;
            } else if (direction === 'prev' && appState.storyPageIndex > 0) {
                appState.storyPageIndex--;
            }
            renderApp();
        }

        function handleModuleComplete(moduleId, score) {
            appState.moduleProgress[moduleId] = score;
        }

        function handleModuleSubmit(isCorrect) {
            if (!appState.isCompleted) {
                appState.showFeedback = true;
                const module = modules[appState.currentModuleIndex];
                handleModuleComplete(module.id, isCorrect ? 100 : 0);
                appState.isCompleted = true;
                renderApp();
            }
        }

        function handleTimelineAnswer(optionId, value) {
            const activity = modules[appState.currentModuleIndex].content.activity;
            if (activity.type !== 'timeline') return;
            appState.activityAnswers[optionId] = value;
            
            // Check if all timeline questions are answered
            const allAnswered = activity.options.every(opt => appState.activityAnswers[opt.id]);
            
            if (allAnswered) {
                const isCorrect = activity.options.every(opt => appState.activityAnswers[opt.id] === opt.answer);
                handleModuleSubmit(isCorrect);
            } else {
                renderApp(); // Re-render to show selected value without submitting
            }
        }
        
        function handleTextAnswer() {
            const activity = modules[appState.currentModuleIndex].content.activity;
            if (!appState.textAnswer || activity.type === 'timeline' || activity.type === 'problem') return;
            const isCorrect = appState.textAnswer.toLowerCase().trim().includes(activity.answer.toLowerCase());
            handleModuleSubmit(isCorrect);
        }

        function handleProblemAnswer(optionId) {
            const activity = modules[appState.currentModuleIndex].content.activity;
            if (activity.type !== 'problem') return;
            appState.textAnswer = optionId;
            const selectedOption = activity.options.find(opt => opt.id === optionId);
            const isCorrect = selectedOption?.correct === true;
            handleModuleSubmit(isCorrect);
        }

        function handleQuizAnswer(questionId, answer) {
            if (!answer) return;
            appState.quizAnswers[questionId] = answer;
            appState.showQuizFeedback[questionId] = true;
            renderApp();
        }

        function checkQuizAnswer(question) {
            const answer = appState.quizAnswers[question.id];
            if (!answer) return false;
            if (question.type === 'fill') {
                const correctAnswers = [question.answer, question.answer2].filter(Boolean).map(a => a.toLowerCase().trim());
                return answer.toLowerCase().trim().split(' ').some(word => correctAnswers.includes(word));
            }
            return answer === question.correct;
        }

        function handleGenerateCertificate() {
            if (appState.userName.trim() !== "") {
                appState.showCertificate = true;
                renderApp();
            } else {
                alert("Por favor, insira o seu nome para gerar o certificado.");
            }
        }

        // --- INITIAL RENDER ---
        document.addEventListener('DOMContentLoaded', renderApp);

    </script>
</body>
</html>